/*! jQuery jquery.pointy - v1.0.1-beta */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&"object"==typeof module.exports?module.exports=a(require("jquery")):a(jQuery)}(function(a){"use strict";var b=a.pointy=function(c,d){var e,f=this;b.version="1.0.1-beta",f.$pointee=a(c),f.pointee=c,f.defaults={pointer:null,arrowWidth:20,borderWidth:1,flipAngle:45,defaultClass:"",activeClass:"pointy-active",borderColor:null,backgroundColor:null,useOffset:null},f.$pointee.data("pointy",f),f.init=function(){f.options=e=a.extend({},f.defaults,d),f.namespace=".pointy"+Math.random().toString(16).slice(2);var b="pointy-update pointy-refresh pointy-show pointy-hide pointy-destroy ".split(" ").join(f.namespace+" ");f.$pointee.on(b,function(b){var c=(b.type||"").replace("pointy-","");c in f&&a.isFunction(f[c])&&f[c]()}),a(window).off("resize"+f.namespace).on("resize"+f.namespace,function(){f.refresh()}),f.show()},f.rad2deg=180/Math.PI,f.regions={n:function(a){if(a.pointer.bottom<a.pointee.top&&a.pointer.midW>a.pointee.left&&a.pointer.midW<a.pointee.right){var b=a.pointer.midW>a.pointee.midW;return a.canvas.width=Math.abs(a.pointer.midW-a.pointee.midW)+e.arrowWidth,a.canvas.height=a.pointee.top-a.pointer.bottom-a.pointer.border,{start:[b?a.canvas.width-e.arrowWidth:0,0],mid:[b?a.halfArrowW:a.canvas.width-a.halfArrowW,a.canvas.height],end:[b?a.canvas.width:e.arrowWidth,0],cLeft:(b?a.pointee.midW:a.pointer.midW)-a.halfArrowW,cTop:a.pointer.bottom-a.pointer.border}}return!1},ne:function(a){if(a.pointer.bottom<=a.pointee.top&&a.pointer.midW>a.pointee.right){var b=Math.atan((a.pointer.left-a.pointee.right)/(a.pointer.bottom-a.pointee.top))*f.rad2deg,c=-b>e.flipAngle&&a.pointer.left>a.pointee.right;return a.canvas.width=c?a.pointer.left-a.pointee.right+a.pointer.border:a.pointer.midW-a.pointee.right+a.pointer.border+e.arrowWidth,a.canvas.height=c?a.pointee.top-a.pointer.midH:a.pointee.top-a.pointer.bottom-a.pointer.border,{start:[a.canvas.width-(c?0:e.arrowWidth),0],mid:[0,a.canvas.height],end:[a.canvas.width,c?e.arrowWidth:0],cLeft:a.pointee.right+(c?a.pointer.border:0),cTop:c?a.pointer.midH:a.pointer.bottom-a.pointer.border}}return!1},e:function(a){if(a.pointer.top<a.pointee.bottom&&a.pointer.bottom>a.pointee.top&&a.pointer.left>=a.pointee.right){var b=a.pointer.midH<a.pointee.midH;return a.canvas.width=a.pointer.left-a.pointee.right+a.pointer.border,a.canvas.height=Math.abs(a.pointee.midH-a.pointer.midH)+e.arrowWidth,{start:[a.canvas.width,b?0:a.canvas.height],mid:[0,b?a.canvas.height-a.halfArrowW:a.halfArrowW],end:[a.canvas.width,b?e.arrowWidth:a.canvas.height-e.arrowWidth],cLeft:a.pointee.right+a.pointer.border,cTop:(b?a.pointer.midH:a.pointee.midH)-a.halfArrowW}}return!1},se:function(a){if(a.pointer.top>=a.pointee.bottom&&a.pointer.midW>=a.pointee.right){var b=Math.atan((a.pointer.left-a.pointee.right)/(a.pointer.top-a.pointee.bottom))*f.rad2deg,c=b>e.flipAngle&&a.pointer.left>a.pointee.right+e.arrowWidth;return a.canvas.width=(c?a.pointer.left:a.pointer.midW+e.arrowWidth)-a.pointee.right+a.pointer.border,a.canvas.height=(c?a.pointer.midH:a.pointer.top)-a.pointee.bottom,{start:[a.canvas.width-(c?0:e.arrowWidth),a.canvas.height],mid:[0,0],end:[a.canvas.width,a.canvas.height-(c?e.arrowWidth:0)],cLeft:a.pointee.right+a.pointer.border,cTop:a.pointee.bottom+a.pointer.border}}return!1},s:function(a){if(a.pointer.top-a.pointee.bottom>=0&&a.pointer.midW>a.pointee.left&&a.pointer.midW<a.pointee.right){var b=a.pointer.midW>a.pointee.midW;return a.canvas.width=Math.abs(a.pointer.midW-a.pointee.midW)+e.arrowWidth,a.canvas.height=a.pointer.top-a.pointee.bottom,{start:[b?a.canvas.width-e.arrowWidth:0,a.canvas.height],mid:[b?a.halfArrowW:a.canvas.width-a.halfArrowW,0],end:[b?a.canvas.width:e.arrowWidth,a.canvas.height],cLeft:(b?a.pointee.midW:a.pointer.midW)-a.halfArrowW,cTop:a.pointee.bottom+a.pointer.border}}return!1},sw:function(a){if(a.pointer.top-a.pointee.bottom>=0&&a.pointer.midW<=a.pointee.left){var b=Math.atan((a.pointer.right-a.pointee.left)/(a.pointer.top-a.pointee.bottom))*f.rad2deg,c=-b>e.flipAngle;return a.canvas.width=c?a.pointee.left-a.pointer.left-a.pointer.width+e.borderWidth:Math.abs(a.pointer.midW-a.pointee.left)+e.arrowWidth,a.canvas.height=c?a.pointer.midH-a.pointee.bottom:a.pointer.top-a.pointee.bottom,{start:[0,a.canvas.height],mid:[a.canvas.width-(c?0:e.arrowWidth),0],end:[c?0:e.arrowWidth,c?a.canvas.height-e.arrowWidth:a.canvas.height],cLeft:c?a.pointer.left+a.pointer.width-a.pointer.border:a.pointer.midW,cTop:a.pointee.bottom+a.pointer.border}}return!1},w:function(a){if(a.pointer.top<a.pointee.bottom&&a.pointer.bottom>a.pointee.top&&a.pointer.right<=a.pointee.left){var b=a.pointer.midH<a.pointee.midH;return a.canvas.width=a.pointee.left-a.pointer.left-a.pointer.width,a.canvas.height=Math.abs(a.pointee.midH-a.pointer.midH)+e.arrowWidth,{start:[0,b?0:a.canvas.height],mid:[a.canvas.width,b?a.canvas.height-a.halfArrowW:a.halfArrowW],end:[0,b?e.arrowWidth:a.canvas.height-e.arrowWidth],cLeft:a.pointer.left+a.pointer.width-a.pointer.border,cTop:(b?a.pointer.midH:a.pointee.midH)-a.halfArrowW}}return!1},nw:function(a){if(a.pointer.bottom<=a.pointee.top&&a.pointer.midW<a.pointee.left){var b=Math.atan((a.pointee.top-a.pointer.bottom)/(a.pointer.right-a.pointee.left))*f.rad2deg,c=b<e.flipAngle&&a.pointer.right<a.pointee.left-e.arrowWidth;return a.canvas.width=a.pointee.left+a.pointer.border-(c?a.pointer.right:a.pointer.midW-e.arrowWidth),a.canvas.height=a.pointee.top-(c?a.pointer.midH:a.pointer.bottom-a.pointer.border),{start:[0,0],mid:[a.canvas.width-(c?0:e.arrowWidth),a.canvas.height],end:[c?0:e.arrowWidth,c?e.arrowWidth:0],cLeft:c?a.pointer.right-a.pointer.border:a.pointer.midW,cTop:c?a.pointer.midH:a.pointer.bottom-a.pointer.border}}return!1}},f.show=function(b){f.$pointer=a(b||f.options.pointer).addClass("pointy "+e.defaultClass),f.$pointer.length&&(f.add(),f.refresh())},f.hide=function(){f.$arrow.remove(),f.$arrow=null,f.visible=!1},f.add=function(){f.$arrow&&f.$arrow.length&&f.$arrow.remove(),f.$arrow=a('<canvas class="pointy '+e.defaultClass+'">').css({position:"absolute",display:"none","pointer-events":"none"}),f.$pointee.after(f.$arrow)},f.refresh=function(){f.setConstants(),f.update()},f.setConstants=function(){if(f.$arrow&&f.$arrow[0].getContext){var a=f.$pointer,b=f.$pointee,c=f.$arrow;f.data={$pointer:a,$pointee:b,canvas:c[0],ctx:c[0].getContext("2d"),pointer:{height:a.outerHeight(!0),width:a.outerWidth(),border:parseInt(a.css("border-width"),10)||0},pointee:{height:b.outerHeight(!0),width:b.outerWidth()},halfArrowW:e.arrowWidth/2,borderColor:e.borderColor||a.css("border-color"),backgroundColor:e.backgroundColor||a.css("background-color")}}},f.update=function(){if(f.$arrow&&f.$arrow[0].getContext){e.activeClass&&(a(".pointy."+e.activeClass).removeClass(e.activeClass),f.$pointer.add(f.$arrow).addClass(e.activeClass));var b=f.data,c=b.$pointer.offset(),d=b.$pointer.position(),g="boolean"==typeof e.useOffset?e.useOffset:d.left===c.left;d=g?c:d,b.pointer.left=d.left,b.pointer.right=d.left+b.pointer.width,b.pointer.top=d.top,b.pointer.bottom=d.top+b.pointer.height,b.pointer.midW=b.pointer.left+b.pointer.width/2,b.pointer.midH=b.pointer.top+b.pointer.height/2,d=g?b.$pointee.offset():b.$pointee.position(),b.pointee.left=d.left,b.pointee.right=d.left+b.pointee.width,b.pointee.top=d.top,b.pointee.bottom=d.top+b.pointee.height,b.pointee.midW=b.pointee.left+b.pointee.width/2,b.pointee.midH=b.pointee.top+b.pointee.height/2,f.calculated=null,a.each(f.regions,function(a,d){return c=d(b),c?(f.calculated=c,!1):void 0}),f.draw()}},f.draw=function(){if(a.isEmptyObject(f.calculated))f.$arrow.hide();else{var b=f.data,c=b.ctx,d=f.calculated;f.$arrow.show().css({left:d.cLeft,top:d.cTop}),f.visible=!0,c.fillStyle=b.backgroundColor,c.strokeStyle=b.borderColor,c.lineWidth=b.borderWidth,c.beginPath(),c.moveTo(d.start[0],d.start[1]),c.lineTo(d.mid[0],d.mid[1]),c.lineTo(d.end[0],d.end[1]),c.fill(),c.stroke()}},f.destroy=function(){f.$arrow.remove(),f.$pointee.off(f.namespace),f.$pointer.removeClass(("pointy "+e.defaultClass+" "+e.activeClass).replace(/\s+/g," ")),a(window).off(f.namespace),a.removeData(f.pointee,"pointy")},f.init()};return a.fn.pointy=function(b){return this.each(function(){var c=a(this).data("pointy");c?c.visible||c.$arrow?c.hide():c.show(b.pointer):new a.pointy(this,b)})},a.fn.getpointy=function(){return this.data("pointy")},b});